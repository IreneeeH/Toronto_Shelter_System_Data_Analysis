---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - First author
  - Another author
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
```


# Introduction

Toronto’s shelter system provides a temporary home to those who are in need of one. The system is essential for Toronto’s homeless population and refugees as the shelters uphold standards that support meals and laundry accommodations, mental health and harm reduction services, and a host of counselors to direct and aid individuals acquire permanent housing. Although the shelters provide a multitude of services and aid to secure permanent housing for the unhoused, there are still many who return to shelters after securing housing.

The affordable housing crisis is directly contributing to Toronto’s shelter availability crisis. As Toronto’s housing market has skyrocketed in the past few years, it is no wonder why Toronto’s shelters are receiving significantly more visitors. According to CBC News, an estimated average of at least 273 individuals were turned away from shelters in June 2023 (), which was a record high for Toronto shelters. The amount of families seeking warm beds has been unmatched and as Toronto’s winters can be extremely frigid, shelter availability is becoming increasingly more critical.

The goal of this paper is to analyze the demographics that utilize Toronto’s shelter system. Varying age groups that utilize shelters are of particular interest. In addition, this paper is also concerned with the actively homeless population and different demographics, such as refugees and single adults, that stay in shelters. Analyzing and studying Toronto’s shelter system data can reveal those within society that are struggling the most with securing housing.

The remainder of this paper is structured as follows: the Data section details the collection and processing of Toronto's shelter system data and displays tables and graphs that help illustrate trends found in the data. The following Discussion section analyzes and draws conclusions from the tables and graphs exhibited in the previous section.


# Data {#sec-data}

The data utilized in this paper was retrieved from the City of Toronto's Open Data Portal. The statistical programming language R was used to retrieve, clean, and process the data. In particular, the following R packages were used: opendatatoronto and tidyverse for data acquistion, and janitor for data cleaning and processing.

The shelter system data acquired from the City of Toronto's Open Data Portal provided monthly statistics of Toronto's shelters from January 2018 to December 2023. For each month, the data set included information for the entire population, chronic visitors, refugees, families, youth, single adults, and non-refugees. The information of interest for each of those demographics are the number of individuals that returned to shelters after previously acquiring housing, those that are new to the shelter system, those that are actively homeless, those that identify as male and female, and the number of individuals in each age group in that demographic. The age groups consist of visitors under 16, 16 to 24, 25 to 44, 45 to 64, and 65 years of age or older.

```{r}
#| echo: false
#| warning: false
#| message: false

#### Workspace set-up ####
library("tidyverse")
#library("dplyr")
library("here")
library("knitr")

# Read in the cleaned data
cleaned_toronto_shelters_data <-
  read_csv(
    file = here("outputs/data/cleaned_toronto_shelters_data.csv"),
    show_col_types = FALSE
  )

```

```{r}
#| label: tbl-sampledata
#| tbl-cap: "Sample set of Toronto shelter system data from 2018 to 2023"
#| echo: false

cleaned_toronto_shelters_data |>
  slice(1:14) |>
  kable(col.names = c("Date", "Population Group", "Returned from Housing", "New to Shelter", "Actively Homeless", "Age Under 16", "Age 16-24","Age 25-44", "Age 45-64", "Age 65+", "Males", "Females"))
```

```{r}
#| label: fig-agegroupavg
#| fig-cap: "The average of all shelter visitors in each age group over 6 years from 2018 to 2023"
#| echo: false
#| warning: false
#| message: false

age_group_data <-  cleaned_toronto_shelters_data|>
    filter(population_group == "All Population") |>
  summarise(
    # Divide by (6*12) since it is 6 years (2018-2023) with 12 months each
    "Under 16" = sum(age_under16, na.rm = TRUE)/(6*12), 
    "16-24" = sum(age_16_24, na.rm = TRUE)/(6*12),  
    "25-44" = sum(age_25_44, na.rm = TRUE)/(6*12),   
    "45-64" = sum(age_45_64, na.rm = TRUE)/(6*12), 
    "65+" = sum(age_65over, na.rm = TRUE)/(6*12)
  ) |>
  pivot_longer(cols = everything(), names_to = "age_group", values_to = "average")

# Create the bar graph
ggplot(age_group_data, aes(x = age_group, y = average, fill = age_group)) +
  geom_bar(stat = "identity") +
  labs(title = "Average Number of Shelter Visitors by Age Group",
       x = "Age Group",
       y = "Average")
```
```{r}
#| label: fig-activelyhomeless
#| fig-cap: "The average number of actively homeless people from 2018 to 2023"
#| echo: false
#| warning: false
#| message: false

avgs_actively_homeless <- rep(NA, times=6) # 6 years (2018 to 2023)
year = 18
for (i in 1:6){
  each_year_actively_homeless <- cleaned_toronto_shelters_data |>
    filter(population_group == "All Population", substring(date, 5, 6) == as.character(year)) |>
    select(actively_homeless)

  avgs_actively_homeless[i] <- sum(each_year_actively_homeless)/12 # 12 months in a year
  
  year = year + 1
}

avgs_actively_homeless_data <-
  tibble(
    date = 2018:2023,
    avg = avgs_actively_homeless
  )

ggplot(avgs_actively_homeless_data, aes(x = date, y = avg, fill = date)) +
  geom_line(stat = "identity") +
  labs(title = "Average Number of Actively Homeless Individuals from 2018 to 2023",
       x = "Year",
       y = "Average")
```

```{r}
#| label: fig-returnedfromhousingavg
#| fig-cap: "The average of number of visitors who returned to shelters from 2018 to 2023"
#| echo: false
#| warning: false
#| message: false

avgs_returned <- rep(NA, times=6) # 6 years (2018 to 2023)
year = 18
for (i in 1:6){
  each_returned_from_housing <- cleaned_toronto_shelters_data |>
    filter(population_group == "All Population", substring(date, 5, 6) == as.character(year)) |>
    select(returned_from_housing)

  avgs_returned[i] <- sum(each_returned_from_housing)/12 # 12 months in a year
  
  year = year + 1
}

avgs_returned_data <-
  tibble(
    date = 2018:2023,
    avg = avgs_returned
  )

ggplot(avgs_returned_data, aes(x = date, y = avg, fill = date)) +
  geom_line(stat = "identity") +
  labs(title = "Average Number of Shelter Returners from 2018 to 2023",
       x = "Year",
       y = "Average")
```

```{r}
#| label: fig-malefemale
#| fig-cap: "The average of all shelter visitors in each age group over 6 years from 2018 to 2023"
#| echo: false
#| warning: false
#| message: false

avgs_male <- rep(NA, times=6) # 6 years (2018 to 2023)
avgs_female <- rep(NA, times=6)
year = 18
for (i in 1:6){
  each_year_male <- cleaned_toronto_shelters_data |>
    filter(population_group == "All Population", substring(date, 5, 6) == as.character(year)) |>
    select(gender_male)
  
  each_year_female <- cleaned_toronto_shelters_data |>
    filter(population_group == "All Population", substring(date, 5, 6) == as.character(year)) |>
    select(gender_female)

  avgs_male[i] <- sum(each_year_male)/12 # 12 months in a year
  avgs_female[i] <- sum(each_year_female)/12
  
  year = year + 1
}

avgs_gender_data <-
  tibble(
    date = 2018:2023,
    avg_males = avgs_male,
    avg_females = avgs_female
  )

ggplot(avgs_gender_data, aes(x=date)) +
  geom_line(aes(y = avg_males), color="blue") +
  geom_line(aes(y = avg_females), color="red")+
  labs(title = "Average Number of Males and Females in Shelters from 2018 to 2023",
       x = "Year",
       y = "Average")
```


# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}

```

```{r}

```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}

```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}

```



\newpage


# References


